package top.todev.note.web.flux.stream;

import lombok.extern.slf4j.Slf4j;
import org.junit.Test;
import top.todev.note.util.FibonacciUtil;

import java.util.concurrent.ForkJoinPool;

/**
 * <p>Stream其他方面测试类</p>
 *
 * @author 小飞猪
 * @version 1.0.0
 * @date 2020-06-12 09:11
 * @since 1.0.0
 **/
@Slf4j
public class StreamOtherTest {

    /**
     * 1至1000006587的单线程累加
     */
    @Test
    public void testAddFunction() {
        long begin = System.currentTimeMillis();
        int n = 10_0000_6587;
        long sum = 0;
        for(int i = 1; i <= n; i++ ) {
            sum += i;
        }
        log.info("1 + 2 + ... {} = {}", n, sum);
        long end = System.currentTimeMillis();
        log.info("函数方式执行时间：{}ms", end - begin);
    }

    /**
     * 1至1000006587的Fork/Join方式累加
     */
    @Test
    public void testAddForkJoin() {
        long begin = System.currentTimeMillis();
        int n = 10_0000_6587;
        ForkJoinPool pool = ForkJoinPool.commonPool();
        log.info("1 + 2 + ... {} = {}", n, pool.invoke(new NumberAddTask(1, n)));
        long end = System.currentTimeMillis();
        log.info("ForkJoin方式执行时间：{}ms", end - begin);
    }

    /**
     * 本方法根据官方Api提供的Fork/Join方式测试斐波那契数列<br />
     * 效果不佳，甚至不如单线程的递归方式，也充分说明Fork/Join不是完成能。
     */
    @Test
    public void testForkJoin() {
        // 执行f(40) = 102334155使用3411ms
        // 执行f(80) 2个多小时，无法计算出结果
        long begin = System.currentTimeMillis();
        int n = 40;
        ForkJoinPool pool = ForkJoinPool.commonPool();
        log.info("ForkJoinPool初始化时间：{}ms", System.currentTimeMillis() - begin);
        log.info("斐波那契数列f({}) = {}", n, pool.invoke(new FibonacciTask(n)));
        long end = System.currentTimeMillis();
        log.info("ForkJoin方式执行时间：{}ms", end - begin);
    }


    /**
     * 不用递归计算斐波那契数列反而更快
     */
    @Test
    public void testFibonacci() {
        // 执行f(50000) 使用 110ms
        // 输出 f(50000) = 1743874137872778683038855433072699016394461156878238973263982336478604120893915051072544313121830563029162005013792559205997598126360649025208447280360359144842479570784654740431357551648823638271979617124071383575324194349162251247653770059111100237978893954288559321454504623215118988129852871458898647889099933493564688306294871327925574775225722944454286614304745740706112522160499958728455898099231796898547337762929545584597966903563441286329282458021772519024162194337749861626000683017307318915530255703808957238936612565731316695956188218501510294114834605839528410187586690861067176928468296144950466663180325157344140933621991698615695546673718579128468149002022630398802274355656088350127985018755304519442374264062300108956277576143668174115467196025175481960604461875945756605572142798302455152879672738013654051037646033220217225700016008985626325782634740834959232341443750061868420837986782521356806264656505055304497160110024503984083572592482462122737629604178561439975778077089476849329460250638453657430211748389531839378571340876249225883758659859967183803050117776799342127308619531371922094101611799632656086714606606520237945182241101099165373079266371971952675529748028407745745170394595053812125010372425221221492652285925362069370838224779095613815716686348777459063721431460865557614130076452863540814404302932417645702748274490404351690006067357887265753904552006609652624907698568188061011140059860258456394392378229572505083818582820797558333851939788979461135085399107873851513942547181946726592266604916227927901020323093743034573955840771795339616011741968327828135610342506272158985635075164496120783429649382111857894197352609142150196072209034137636503323436883128122381374085611862601644042317821882141757121670835057574162734695021855669716665718781016475259647897895659984228724222445929980030647103134042059942775105293595385326399875065139841911751702429177389784705871568394819190106721368436886552756102337390079147375903342422157729709155925563380503437763307344804404628939273900236761180216183073179980310408713418928137185753387911837331162325055726794057265177772370749114785326844759181908692842240387182968761863592408691784570572724979328231612122928000242914313469640608517833334451569208997631412782286258864434732799712984437127901834760313643721854135309033247672942634683125366100429650419074241103553125827060261495980116830712785686742618043562584947918960627360182515469177274903730319753345711438046114303780960976791884560275748256151471005090041313813478021533727476393216244062876957980352394507343193790552660530656455407837687087019687572441586754611625773425618491907781450945253264704856916122487990656422512610683877076844351293766273504834394503304795739542241249194868499209990642140951060806522698907641306027087606233389689785819177205397312085698273997811563115591680074906629311234613256743587057997614639446742851018838538634529917340954696119687906703927182782941564754323718694578072062632400989379199692938533110122536614724311040687033721286975595529824123586098023050215881508138581094901690545456357169866147953710007356208634754226170691285705246022616144605957558630576527814172279967072811692870222473590674033772958159328696099382009437580327743494308088017874345489057563770743079093261193610625379385752412229957448205642365161616795088509376845353434009681506830812239756553143961187658435999463369024457210984469138675618589189559406500710933388311917915794329261761309843308242117197298788097529191059024860320377431450513717075201182605236857332579363850682319498550223040891849940860748832778562991275940082353861576970542405368271600052940784500671478993359637523672016242067143585317870892989158709592240821197425856210023764169743827384879965835741212023727605484002288029133886971302554126327453687227776639578080671656836651842992963361193636337981287157434108726273357479166898784860703416769041599139374704005498384975598209928713685712595415136833825531767614335166232828331915666499428277936493063878987680355595227265192716846988959418623511359871349229400830992249424751796297855884126249026801638630183583688188787460977210119402205344962200386757535757192141415024993911374387604851791941961516530877642737571905254606881045796495108583860546296122718355051375538526011281503293121149146056961837023370439158379138196418393130193373061315845231974945954150347529551371170459983269513585255733823309010693486321980613152170937479094060705195323933677685970225593654709025623733892989926117078363680776448645854222086177939808122317034971738180024790424700478719623847211049057924029501671285499777861028964889119500586677594171659111162117723890698466427301911217337229339400965093765324495237621210618273846709682772299191082274259082381989390197005179442702538808430985864155701601658703734585352300005878509022427184394278443297797321809072830073775626565471437435450482161033942660138327956135591719629144871425713133129513431986296881439343247799999123377546726077878982738564629720726114720138488334820159771212754640847855999948240313038169372971478645646276587367239968524934283664954905343176854983787464638928155690360827366556678491605251352992581538151520552763057107326844979162733979920337236924093223489178212430564136816585301464932281168331507492550335655531040262915996741775383774047498747779491588058114681040591272158006526345143869683851363828889666122579499846047263452123671592514317134498339379954228630797498396176128823513618061483370280966477515912006410201937939240661606334580887581272576692908858691290576893938771379586623270136250223305917459746861942505642446986495699583208430948726015697369258029886474013936339524298180756487118748806223079648628783930323766640271754886952157075898425045930355037882239329472948959055744158184632469426392183238195310465801783967981982562640369305824963618833200690535101248460585874539568900727959233277911227236279342734954886094277180859012467864926227354784147687350193994779251766089262268887297124861546865163072100378361155739908141548685732248717904691878505456967811539242147822432459377381159915720201670894345933634860016841990700713922162029465061281808994469920549052906492318502916298882164211461022220595085361673141236742646480655142451819942552252695017263023897593719723326617762854997127401476212306565400225669509795889665763480453096496434266546258549968289572338758015801546487730840632429153823876902906907506677467081414712221588886430611411966187083896579557451169772102017788374020265615974596580002934020702773018955068626471967411046450744784436362637581874584705852735043396629539147918884700724784604906500541489336330044234308605607632219610744970234976431225062692981958841382030872811638562849997427164883421713463381155263795180614081636671298076528274450609716821850791655937072038712580462825972937880879588795797631456734920557635118364116393385427558060360131567011127342098610348624874563891571955203995655266641419259029039995661216724817875823320643948461221574380255145911717295481888106943075381676641692333269348173861334002296749359808503692114823696409509322052888242572836655650267423526781963372891020243220615234027406371292335676107446328897195622330986477378235827171776834542524739701679587226767650807138834534342301876637708929728884635585023070897738300415325766845092317379441345046938487460023918812406860763378690219365836654077807926056431009085623195456571325386915560697482629943773518822280228311163501545560078380729447761980709081950398286412723695351810211573314165859024809554756910390350801827984124822205075789855221525981942579804587344351542448922732861380856815025199288872027685891193970022850352497119324550177507470992559835457730904131389645039356105171114763872669983775322474848970824098543418125628460166059629549278898701385839142699448298525675674251554186943207168881742143427442377380736242215878904891216765558549958855711368053972056199595819830857935330812556544471736669457560062939400161572486565294029978182961330242659733373811804833604315507970217588367909827297950930041905718735077914069653959627352456358584468436345694736703455837793739317784656638995211530677494401107999434306639947081407765946759658923111463344166969259422060424377197288406967867902748594966604778558451849027078280636155477279100467344788091772971600948354108063480121307754529441735918140338585344137697798606839390033925858532090100652455568414900094821808946330588629340756777573606904405161731280311562979668914091655400051772490467675245217288611344748501351125828965103057324985181213612401363707454795764749056968700799911006828745910292949118479524470664506299331475085555077027769263697640244231491429108764900659097888493729789145205203698638033458755611691156536779718947721274943918266289316048174484294024401967642514273058649988791218103931191213989054670422764175730510106465248737618456952305722343575387935429115745193763888638522094995718834784492809200888145047063042190362952756897093622878457455003075159842756002392769595344162158108530950167920784402403975595018224534206400712299461422196584479776648819963188358347405244856504967744837886292123682749291960697327306368342112340353207847895196210717255612698173124546693701736291862760500542943203411803866969948124614181434746916047287603993249979374353182920560122508933667693591117581786724659722527725140344803391308569065094257502169428602645583983068179540639737320194543421705903187647822201752376987850426019729381937004299149655264707707189511594106366158567334275978915731657137607233727219325811184605675702978240860572621387469338707553715724513344328586642473426359516210909249486213794865913702910553288481625136443970556585726227521010841496433861771384708194923429379257091321749614479325174770673029735917016112708602257431148788308164444545354908297758289087073467272597711978415052181380430251402588938552191996181807979333046101741817004456650201798600334710554762389810176323785302976881475585070493005787698286376506710017537727906671878529667398585710145670859067641545863166299530521038581592624637539928496968639558307937273641634858250063871865690931612452571460249665248680099243004795908828911125287445169671414262166292093290388342041664889992972653051934301139674450361647950352463803857272412121471316733065457563712911737935688967710777431213398558420321493270972376370097952087361603629709189401782994951411784350329193461949211038096545532795165183846591101778515975664669900002170616840001211190626
        long begin = System.currentTimeMillis();
        int n = 50000;
        log.info("斐波那契数列f({}) = {}", n, FibonacciUtil.fibonacci(n));
        long end = System.currentTimeMillis();
        log.info("函数方式执行时间：{}ms", end - begin);
    }

}
